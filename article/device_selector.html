<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è®¾å¤‡å‹å·é€‰æ‹©å™¨</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 500px;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            color: #333;
            font-size: 28px;
            margin-bottom: 10px;
        }
        .header p {
            color: #666;
            font-size: 16px;
        }
        .form-group {
            margin-bottom: 25px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 16px;
        }
        .form-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            font-size: 16px;
            background: white;
            transition: all 0.3s ease;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 16px;
        }
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        .form-group select:disabled {
            background-color: #f8f9fa;
            color: #6c757d;
        }
        .submit-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }
        .submit-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        .submit-btn:active {
            transform: translateY(0);
        }
        .submit-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        option:disabled {
            color: #888;
            background-color: #f8f9fa;
            font-style: italic;
            text-align: center;
        }
        #result {
            display: none;
            margin-top: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 15px;
            border-left: 5px solid #667eea;
        }
        .result-header {
            color: #333;
            margin-bottom: 15px;
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .device-info {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .device-info p {
            margin: 12px 0;
            font-size: 16px;
            line-height: 1.5;
        }
        .device-info strong {
            color: #333;
            display: inline-block;
            width: 80px;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 16px;
        }
        .error {
            background: #fee;
            color: #c33;
            padding: 15px;
            border-radius: 8px;
            border-left: 5px solid #c33;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            body {
                padding: 15px;
                align-items: flex-start;
            }
            .container {
                padding: 20px;
                border-radius: 15px;
            }
            .header h1 {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“± è®¾å¤‡å‹å·é€‰æ‹©å™¨</h1>
            <p>é€‰æ‹©è®¾å¤‡ç±»åˆ«å’Œå…·ä½“å‹å·æŸ¥è¯¢ä¿¡æ¯</p>
        </div>

        <div class="form-group">
            <label for="category">ğŸ¯ è®¾å¤‡ç±»åˆ«</label>
            <select id="category" name="category" disabled>
                <option value="">åŠ è½½è®¾å¤‡æ•°æ®ä¸­...</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="model">ğŸ”§ è®¾å¤‡å‹å·</label>
            <select id="model" name="model" disabled>
                <option value="">è¯·å…ˆé€‰æ‹©è®¾å¤‡ç±»åˆ«</option>
            </select>
        </div>
        
        <button id="submit-btn" class="submit-btn" type="button" disabled>
            æŸ¥è¯¢è®¾å¤‡ä¿¡æ¯
        </button>

        <div id="result"></div>
    </div>

    <script>
        // è®¾å¤‡æ•°æ®å˜é‡
        let deviceData = [];
        let dataLoaded = false;

        // åŠ è½½è®¾å¤‡æ•°æ®
        function loadDeviceData() {
            console.log('å¼€å§‹åŠ è½½è®¾å¤‡æ•°æ®...');
            
            // ä½¿ç”¨ç›¸å¯¹è·¯å¾„ - å› ä¸ºæ–‡ä»¶åœ¨åŒä¸€ä¸ªç›®å½•
            fetch('get_device_data.php')
                .then(response => {
                    console.log('å“åº”çŠ¶æ€:', response.status);
                    if (!response.ok) {
                        throw new Error(`HTTPé”™è¯¯: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('æˆåŠŸè·å–æ•°æ®:', data);
                    console.log('æ•°æ®é•¿åº¦:', data.length);
                    
                    if (data && Array.isArray(data) && data.length > 0) {
                        deviceData = data;
                        dataLoaded = true;
                        initCategorySelect();
                    } else {
                        throw new Error('è¿”å›çš„æ•°æ®ä¸ºç©ºæˆ–æ ¼å¼ä¸æ­£ç¡®');
                    }
                })
                .catch(error => {
                    console.error('æ•°æ®åŠ è½½å¤±è´¥:', error);
                    document.getElementById('category').innerHTML = '<option value="">æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢</option>';
                    document.getElementById('category').disabled = false;
                });
        }

        // åˆå§‹åŒ–ç±»åˆ«ä¸‹æ‹‰æ¡†
        function initCategorySelect() {
            const categorySelect = document.getElementById('category');
            categorySelect.innerHTML = '<option value="">è¯·é€‰æ‹©è®¾å¤‡ç±»åˆ«</option>';
            
            deviceData.forEach(item => {
                const option = document.createElement('option');
                option.value = item[0];
                option.textContent = getBrandEmoji(item[0]) + ' ' + item[0];
                categorySelect.appendChild(option);
            });
            
            categorySelect.disabled = false;
            console.log('ç±»åˆ«é€‰æ‹©æ¡†åˆå§‹åŒ–å®Œæˆ');
        }

        // è·å–å“ç‰Œemojiå›¾æ ‡
        function getBrandEmoji(brand) {
            const emojiMap = {
                'iphone': 'ğŸ“±',
                'ipad': 'ğŸ’»', 
                'iwatch': 'âŒš',
                'ipod': 'ğŸµ',
                'Galaxy': 'ğŸŒŸ',
                'SONY': 'ğŸ”Š',
                'Google': 'ğŸ”',
                'SHARP': 'ğŸ“º',
                'OPPO': 'ğŸ“¸',
                'Xiaomi': 'ğŸŒ¾',
                'HUAWEI': 'ğŸ‡¨ğŸ‡³',
                'ASUS': 'âš¡',
                'Fujitsu': 'ğŸ’¼',
                'LG': 'ğŸ–¥ï¸',
                'Motorola': 'ğŸ¦…',
                'ZTE': 'ğŸ“¶',
                'HTC': 'ğŸ“',
                'Switch': 'ğŸ®',
                'Surface': 'ğŸ’»',
                'ã‚¬ãƒ©ã‚±ãƒ¼': 'ğŸ“Ÿ'
            };
            return emojiMap[brand] || 'ğŸ“‹';
        }

        // æ›´æ–°å‹å·ä¸‹æ‹‰æ¡†
        function updateModelSelect(categoryValue) {
            if (!dataLoaded) {
                alert('æ•°æ®å°šæœªåŠ è½½å®Œæˆï¼Œè¯·ç¨å...');
                return;
            }
            
            const modelSelect = document.getElementById('model');
            const submitBtn = document.getElementById('submit-btn');
            
            modelSelect.innerHTML = '';
            modelSelect.disabled = true;
            submitBtn.disabled = true;
            
            if (!categoryValue) {
                modelSelect.innerHTML = '<option value="">è¯·å…ˆé€‰æ‹©è®¾å¤‡ç±»åˆ«</option>';
                modelSelect.disabled = false;
                return;
            }
            
            const category = deviceData.find(item => item[0] === categoryValue);
            if (!category) {
                console.error('æœªæ‰¾åˆ°ç±»åˆ«:', categoryValue);
                return;
            }
            
            const models = category[1];
            
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = 'è¯·é€‰æ‹©å…·ä½“å‹å·';
            modelSelect.appendChild(defaultOption);
            
            models.forEach(modelGroup => {
                const groupOption = document.createElement('option');
                groupOption.value = '';
                groupOption.textContent = `â”€â”€ ${modelGroup[0]} â”€â”€`;
                groupOption.disabled = true;
                modelSelect.appendChild(groupOption);
                
                modelGroup[1].forEach(model => {
                    const option = document.createElement('option');
                    option.value = model;
                    option.textContent = model;
                    modelSelect.appendChild(option);
                });
            });
            
            modelSelect.disabled = false;
            console.log('å‹å·é€‰æ‹©æ¡†æ›´æ–°å®Œæˆ');
        }

        // æäº¤æŸ¥è¯¢
        function submitQuery() {
            if (!dataLoaded) {
                alert('æ•°æ®å°šæœªåŠ è½½å®Œæˆï¼Œè¯·ç¨åé‡è¯•');
                return;
            }
            
            const category = document.getElementById('category').value;
            const model = document.getElementById('model').value;
            const resultDiv = document.getElementById('result');
            
            if (!category || !model) {
                alert('è¯·é€‰æ‹©å®Œæ•´çš„è®¾å¤‡ä¿¡æ¯');
                return;
            }
            
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="loading">ğŸ” æŸ¥è¯¢ä¸­ï¼Œè¯·ç¨å€™...</div>';
            
            // é˜²æ­¢é‡å¤ç‚¹å‡»
            document.getElementById('submit-btn').disabled = true;
            
            // æ¨¡æ‹ŸæŸ¥è¯¢ç»“æœï¼ˆå®é™…ä½¿ç”¨æ—¶æ›¿æ¢ä¸ºçœŸå®çš„AJAXè¯·æ±‚ï¼‰
            setTimeout(() => {
                const mockData = {
                    price: 'ï¿¥' + (Math.random() * 10000 + 1000).toFixed(0),
                    stock: Math.floor(Math.random() * 100),
                    description: 'è¿™æ˜¯ ' + model + ' çš„è¯¦ç»†ä¿¡æ¯æè¿°'
                };
                
                displayResult(mockData, category, model);
                document.getElementById('submit-btn').disabled = false;
            }, 1500);
        }

        // æ˜¾ç¤ºæŸ¥è¯¢ç»“æœ
        function displayResult(data, category, model) {
            const resultDiv = document.getElementById('result');
            
            resultDiv.innerHTML = `
                <div class="result-header">
                    <span>ğŸ“‹ æŸ¥è¯¢ç»“æœ</span>
                </div>
                <div class="device-info">
                    <p><strong>è®¾å¤‡ç±»åˆ«:</strong> ${category}</p>
                    <p><strong>å…·ä½“å‹å·:</strong> ${model}</p>
                    <p><strong>ğŸ’° å‚è€ƒä»·æ ¼:</strong> ${data.price}</p>
                    <p><strong>ğŸ“¦ æ¨¡æ‹Ÿåº“å­˜:</strong> ${data.stock} å°</p>
                    <p><strong>ğŸ“ äº§å“æè¿°:</strong> ${data.description}</p>
                    <p><em>ğŸ’¡ æç¤º: è¿™æ˜¯æ¨¡æ‹Ÿæ•°æ®ï¼Œå®é™…ä½¿ç”¨æ—¶è¿æ¥æ•°æ®åº“è·å–çœŸå®ä¿¡æ¯</em></p>
                </div>
            `;
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åŠ è½½è®¾å¤‡æ•°æ®...');
            loadDeviceData();
            
            // äº‹ä»¶ç›‘å¬
            document.getElementById('category').addEventListener('change', function() {
                updateModelSelect(this.value);
            });
            
            document.getElementById('model').addEventListener('change', function() {
                document.getElementById('submit-btn').disabled = !this.value;
            });
            
            document.getElementById('submit-btn').addEventListener('click', submitQuery);
        });

        // è°ƒè¯•å‡½æ•° - åœ¨æ§åˆ¶å°è¾“å…¥ checkData() æŸ¥çœ‹æ•°æ®çŠ¶æ€
        window.checkData = function() {
            console.log('=== æ•°æ®çŠ¶æ€æ£€æŸ¥ ===');
            console.log('deviceData:', deviceData);
            console.log('dataLoaded:', dataLoaded);
            console.log('æ•°æ®é•¿åº¦:', deviceData.length);
            console.log('ç¬¬ä¸€ä¸ªå“ç‰Œ:', deviceData[0] ? deviceData[0][0] : 'æ— ');
        };
    </script>
</body>
</html>